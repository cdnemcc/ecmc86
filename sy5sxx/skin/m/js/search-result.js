$(function(){function i(i,a){for(var e="",t=0;t<i.length;t++){for(var s=i[t],n=s.url?s.url.replace(resourceprefix,prefix):"",o={},d=0;d<s.downloadlink.length;d++){var r=s.downloadlink[d].type,l=s.downloadlink[d].jailbreak,c=r;"Y"==l&&(c+="-bp"),o[c]=s.downloadlink[d]}var v={},f=0;browser.versions.ios||browser.versions.iPhone||browser.versions.iPad?"undefined"!=typeof o.ipa?v=o.ipa:(v=o["ipa-bp"],f=1):v=browser.versions.android?o.apk:o.apk,e+='<div class="game-item1-container"><div class="game-item1 table">',e+='    <div class="tr">',e+='        <div class="td td1">',1==s.attribute||3==s.attribute?e+='            <div class="hot"></div>':"Y"==s.newflag&&(e+='            <div class="new"></div>'),e+='            <a href="'+n+'"><img src="'+prefix+addSizeSuffix(s.logofile,120,120)+'" data-original-src="'+prefix+s.logofile+'" onerror="loadIconError(this);" class="img" /></a>',e+="        </div>",e+='        <div class="td td2">',e+='            <a href="'+n+'"><div class="title">'+s.title+"</div>",e+='            <div class="text">'+(s.filesize||"--")+"/"+s.downloadnum+"次下载</div>",e+='            <div class="star5"><div class="star-ruler">',e+='                <div class="level" style="width:'+20*(s.score||0)+'%;"><div class="level-bg"></div></div>',e+="            </div></div>",e+='            <div class="text">'+(s.instruction||"")+"</div></a>",e+=v?'            <a href="'+prefix+v.link+'" class="link-download" data-gameid="'+s.id+'" data-filepath="'+v.filepath+'" data-isbp="'+f+'"></a>':'            <a href="#" class="link-download disabled" onclick="return false;"></a>',e+="        </div>",e+="    </div>",e+="</div></div>"}$(a).parent().before(e)}function a(a){$(a).hide().next().show();var e=$("#_query").val(),t=parseFloat($(a).attr("data-pageindex")),s=parseFloat($(a).attr("data-pagesize"));!function(a,t){$.ajax({url:prefix+"api/game/searchdata",type:"POST",data:{siteid:siteid,query:e,pageindex:t,pagesize:s,titleonly:"true",columns:"id,catalogid,logofile,url,link,downloadlink,attribute,newflag,name,title,filesize,downloadnum,instruction,version,score"},dataType:"json",success:function(e){$(a).attr("data-pageindex",t+1);var s=e._RESULT;i(s,a),e.pagesize*(e.pageindex+1)<e.total&&$(a).show(),"function"==typeof updateLinkDownloadStatus&&updateLinkDownloadStatus()},error:function(){},complete:function(){$(a).next().hide()}})}(a,t)}function e(){$(".block-link-more .link").after('<div class="link loading" style="display:none;">加载中</div>').click(function(){return a(this),!1})}e()}),$(function(){$(document).on("click",".link-download",function(i){if(!$(this).hasClass("disabled")&&!isWeiXin()){if(browser.versions.ios||browser.versions.iPhone||browser.versions.iPad)return i.preventDefault(),kDownloadIOSGame(this,!0),!0;browser.versions.android;var a=$(this).attr("data-stat");a&&$.get(a)}})});